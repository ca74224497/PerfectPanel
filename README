ЗАДАНИЕ # 1:

Исправление запроса (простестировано на данных из дампа БД "test_book.sql").

Версия 1:

SELECT u.ID,
       u.Name,
       b.author AS `Author`,
       GROUP_CONCAT(DISTINCT b.name SEPARATOR ', ') AS `Books`
FROM (SELECT users.id AS `ID`,
             CONCAT(users.first_name, ' ', users.last_name) AS `Name`
      FROM `users`
      WHERE users.id IN (SELECT users.id
                         FROM `users`, `user_books`
                         WHERE users.id = user_books.user_id AND users.age BETWEEN 7 AND 17
                         GROUP BY users.id
                         HAVING COUNT(*) = 2)
     ) AS `u`
         LEFT JOIN `user_books` AS `ub` ON u.ID = ub.user_id
         LEFT JOIN `books` AS `b` ON ub.book_id = b.id
GROUP BY b.author, u.id
HAVING COUNT(*) = 2
ORDER BY b.author ASC

Версия 2 (без JOIN-ов):

SELECT u.ID,
       u.Name,
       b.author AS `Author`,
       GROUP_CONCAT(DISTINCT b.name SEPARATOR ', ') AS `Books`
FROM (SELECT users.id AS `ID`,
             CONCAT(users.first_name, ' ', users.last_name) AS `Name`,
             GROUP_CONCAT(DISTINCT user_books.book_id SEPARATOR ',') AS `Books`
      FROM `users`, `user_books`
      WHERE users.id = user_books.user_id AND users.age BETWEEN 7 AND 17
      GROUP BY users.id
      HAVING COUNT(*) = 2) AS `u`, `books` AS `b`
WHERE FIND_IN_SET(b.id, `Books`)
GROUP BY b.author, u.ID
HAVING COUNT(*) = 2
ORDER BY b.author ASC

